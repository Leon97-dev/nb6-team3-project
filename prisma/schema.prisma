generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===================================
// ğŸ¢ Company (íšŒì‚¬)
// ===================================
model Company {
  id          Int    @id @default(autoincrement())
  companyName String
  companyCode String @unique

  // Relations
  users     User[]
  cars      Car[]
  customers Customer[]
  contracts Contract[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===================================
// ğŸ‘¨ğŸ»â€ğŸ’¼ User (ì§ì›: íšŒì‚¬ ì†Œì†, ê´€ë¦¬ì í¬í•¨)
// ===================================
model User {
  id             Int     @id @default(autoincrement())
  name           String
  email          String  @unique
  employeeNumber String
  phoneNumber    String
  password       String
  imageUrl       String?
  isAdmin        Boolean @default(false)

  // Relations
  companyId Int
  company   Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  contracts    Contract[]
  uploadedDocs ContractDocument[] @relation("UploadedDocs")

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@unique([companyId, employeeNumber])
}

// ===================================
// ğŸš— Car (ì°¨ëŸ‰)
// ===================================
model Car {
  id        Int       @id @default(autoincrement())
  carNumber String
  status    CarStatus @default(POSSESSION)

  // ì°¨ëŸ‰ ìƒíƒœ
  manufacturingYear Int
  mileage           Int
  price             Int
  accidentCount     Int
  explanation       String?
  accidentDetails   String?

  // Relations
  companyId  Int
  carModelId Int
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Restrict)
  carModel   CarModel @relation(fields: [carModelId], references: [id], onDelete: Restrict)

  contracts Contract[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@unique([companyId, carNumber])
  @@index([carModelId])
}

// ===================================
// ğŸš˜ CarModel (ì°¨ëŸ‰ ëª¨ë¸)
// ===================================
model CarModel {
  id           Int     @id @default(autoincrement())
  manufacturer String
  model        String
  type         CarType

  // Relations
  cars Car[]

  // indexes
  @@unique([manufacturer, model])
  @@index([type])
}

// ===================================
// ğŸ§‘ğŸ»â€ğŸ’¼ Customer (ê³ ê°)
// ===================================
model Customer {
  id          Int       @id @default(autoincrement())
  name        String
  gender      Gender
  phoneNumber String
  ageGroup    AgeGroup?
  region      Region?
  email       String?
  memo        String?

  // Relations
  companyId Int
  company   Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  contracts Contract[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@unique([companyId, email])
  @@unique([companyId, phoneNumber])
  @@index([companyId, name])
}

// ===================================
// ğŸ“‹ Contract (ê³„ì•½)
// ===================================
model Contract {
  id             Int            @id @default(autoincrement())
  status         ContractStatus @default(CAR_INSPECTION)
  contractPrice  Int
  resolutionDate DateTime

  // Relations
  companyId Int
  company   Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  userId Int
  user   User @relation(fields: [userId], references: [id], onDelete: Restrict)

  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  carId Int
  car   Car @relation(fields: [carId], references: [id], onDelete: Cascade)

  meetings  ContractMeeting[]
  documents ContractDocument[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@index([companyId, status])
  @@index([companyId, customerId])
  @@index([companyId, carId])
  @@index([companyId, userId])
}

// ===================================
// ğŸ“† ContractMeeting (ê³„ì•½ ë¯¸íŒ…)
// ===================================
model ContractMeeting {
  id   Int      @id @default(autoincrement())
  date DateTime

  // Relations
  contractId Int
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)

  alarms MeetingAlarm[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@index([contractId])
}

// ===================================
// â° MeetingAlarm (ë¯¸íŒ… ì•ŒëŒ)
// ===================================
model MeetingAlarm {
  id      Int      @id @default(autoincrement())
  alarmAt DateTime

  // Relations
  contractMeetingId Int
  meeting           ContractMeeting @relation(fields: [contractMeetingId], references: [id], onDelete: Cascade)

  // indexes
  @@index([contractMeetingId])
}

// ===================================
// ğŸ—„ï¸ ContractDocument (ê³„ì•½ì„œ íŒŒì¼)
// ===================================
model ContractDocument {
  id          Int    @id @default(autoincrement())
  fileName    String
  fileUrl     String
  fileSize    Int
  contentType String

  // Relations
  contractId       Int
  uploadedByUserId Int?
  contract         Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)
  uploadedByUser   User?    @relation("UploadedDocs", fields: [uploadedByUserId], references: [id], onDelete: SetNull)

  // timestamps
  createdAt DateTime @default(now())

  // indexes
  @@index([contractId])
}

// ===================================
// ğŸ§© ENUM ì •ì˜
// ===================================
enum Gender {
  MALE // ë‚¨ì„±
  FEMALE // ì—¬ì„±
}

enum AgeGroup {
  TEEN_10 // 10ëŒ€
  TWENTIES_20 // 20ëŒ€
  THIRTIES_30 // 30ëŒ€
  FORTIES_40 // 40ëŒ€
  FIFTIES_50 // 50ëŒ€
  SIXTIES_60 // 60ëŒ€
  SEVENTIES_70 // 70ëŒ€
  EIGHTIES_80 // 80ëŒ€
}

enum Region {
  SEOUL // ì„œìš¸
  GYEONGGI // ê²½ê¸°
  INCHEON // ì¸ì²œ
  GANGWON // ê°•ì›
  CHUNGBUK // ì¶©ë¶
  CHUNGNAM // ì¶©ë‚¨
  SEJONG // ì„¸ì¢…
  DAEJEON // ëŒ€ì „
  JEONBUK // ì „ë¶
  JEONNAM // ì „ë‚¨
  GWANGJU // ê´‘ì£¼
  GYEONGBUK // ê²½ë¶
  GYEONGNAM // ê²½ë‚¨
  DAEGU // ëŒ€êµ¬
  ULSAN // ìš¸ì‚°
  BUSAN // ë¶€ì‚°
  JEJU // ì œì£¼
}

enum CarType {
  COMPACT // ê²½Â·ì†Œí˜•
  MID_SIZE // ì¤€ì¤‘Â·ì¤‘í˜•
  LARGE // ëŒ€í˜•
  SPORTS_CAR // ìŠ¤í¬ì¸ ì¹´
  SUV
}

enum CarStatus {
  POSSESSION // ëŒ€ê¸°ì¤‘
  CONTRACT_PROCEEDING // ê³„ì•½ ì§„í–‰ì¤‘
  CONTRACT_COMPLETED // ê³„ì•½ ì™„ë£Œ
}

enum ContractStatus {
  CAR_INSPECTION // ì°¨ëŸ‰ ì ê²€
  PRICE_NEGOTIATION // ê°€ê²© í˜‘ìƒ
  CONTRACT_DRAFT // ê³„ì•½ì„œ ì´ˆì•ˆ
  CONTRACT_SUCCESSFUL // ê³„ì•½ ì„±ê³µ
  CONTRACT_FAILED // ê³„ì•½ ì‹¤íŒ¨
}
