generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===================================
// ğŸ¢ Company (íšŒì‚¬)
// ===================================
model Company {
  id Int @id @default(autoincrement())
  companyName String @unique
  companyCode String @unique

  // Relations
  users User[]
  cars Car[]
  customers Customer[]
  contracts Contract[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ===================================
// ğŸ‘¨ğŸ»â€ğŸ’¼ User (ì§ì›: íšŒì‚¬ ì†Œì†, ê´€ë¦¬ì í¬í•¨)
// ===================================
model User {
  id Int @id @default(autoincrement())
  name String
  email String @unique
  password String
  employeeNumber String 
  phoneNumber String
  imageUrl String?
  isAdmin Boolean @default(false)

  // Relations
  companyId Int
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  contracts Contract[]
  uploadedDocs ContractDocument[] @relation("UploadedDocs")
  uploadedImages Image[] @relation("UploadedImages")

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@index([companyId])
  @@unique([companyId, employeeNumber])
}

// ===================================
// ğŸš— Car (ì°¨ëŸ‰)
// ===================================
model Car {
  id Int @id @default(autoincrement())
  carNumber String
  manufacturer String
  model String
  type CarType
  status CarStatus @default(POSSESSION)

  // ì°¨ëŸ‰ ìƒíƒœ
  manufacturingYear Int
  mileage Int
  price Int
  accidentCount Int
  explanation String?
  accidentDetails String?


  // Relations
  companyId Int
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  contracts Contract[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@index([companyId])
  @@unique([companyId, carNumber])
}

// ===================================
// ğŸ§‘ğŸ»â€ğŸ’¼ Customer (ê³ ê°)
// ===================================
model Customer {
  id Int @id @default(autoincrement())
  name String
  gender Gender
  phoneNumber String
  ageGroup AgeGroup?
  region Region?
  email String?
  memo String?

  // Relations
  companyId Int
  company Company @relation(fields: [companyId], references: [id], onDelete:  Restrict)

  contracts Contract[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@index([companyId])
  @@index([companyId, name])
  @@index([companyId, email])
  @@unique([companyId, phoneNumber])
  @@unique([companyId, email])
}

// ===================================
// ğŸ“‹ Contract (ê³„ì•½)
// ===================================
model Contract {
  id Int @id @default(autoincrement())
  status ContractStatus @default(CAR_INSPECTION)
  contractName   String?
  contractPrice  Int?
  resolutionDate DateTime?

  // Relations
  companyId Int 
  company Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  userId Int? // ë‹´ë‹¹ì(ìœ ì €): ì‚­ì œ ì‹œ ê³„ì•½ì€ ìœ ì§€, ë‹´ë‹¹ìë§Œ null 
  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  customerId Int // ê³ ê°: ì‚­ì œ ì‹œ ê´€ë ¨ ê³„ì•½/ë¯¸íŒ…/ì•ŒëŒ/ê³„ì•½ì„œ ëª¨ë‘ ì‚­ì œ 
  customer Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  carId Int // ì°¨ëŸ‰: ì‚­ì œ ì‹œ ê´€ë ¨ ê³„ì•½/ë¯¸íŒ…/ì•ŒëŒ/ê³„ì•½ì„œ ëª¨ë‘ ì‚­ì œ 
  car Car @relation(fields: [carId], references: [id], onDelete: Cascade)

  meetings  ContractMeeting[]
  documents ContractDocument[]

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // indexes
  @@index([companyId, status])
  @@index([companyId, customerId])
  @@index([companyId, carId])
}

// ===================================
// ğŸ“† ContractMeeting (ê³„ì•½ ë¯¸íŒ…)
// ===================================
model ContractMeeting {
  id         Int      @id @default(autoincrement())
  date   DateTime // ë¯¸íŒ… ë‚ ì§œ ë° ì‹œê°„

  // Relations
  contractId Int
  contract   Contract @relation(fields: [contractId], references: [id], onDelete: Cascade)

  // timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  alarms MeetingAlarm[]

  // indexes
  @@index([contractId])
}

// ===================================
// â° MeetingAlarm (ë¯¸íŒ… ì•ŒëŒ)
// ===================================
model MeetingAlarm {
  id                Int             @id @default(autoincrement())
  alarmAt DateTime // ì•ŒëŒ ì‹œê°„

  // Relations
  contractMeetingId Int
  meeting           ContractMeeting @relation(fields: [contractMeetingId], references: [id], onDelete: Cascade)

  // timestamps
  @@index([contractMeetingId])
} 

// ===================================
// ğŸ—„ï¸ ContractDocument (ê³„ì•½ì„œ íŒŒì¼)
// ===================================
model ContractDocument {
  id Int @id @default(autoincrement())
  fileName    String // ì›ë³¸ íŒŒì¼ëª…
  fileUrl     String // ì €ì¥ëœ íŒŒì¼ URL
  fileSize    Int? // íŒŒì¼ í¬ê¸° (ë°”ì´íŠ¸ ë‹¨ìœ„)
  contentType String?  // MIME íƒ€ì…

  // Relations
  contractId Int?
  contract   Contract? @relation(fields: [contractId], references: [id], onDelete: Cascade)

  uploadedByUserId Int?
  uploadedByUser   User? @relation("UploadedDocs", fields: [uploadedByUserId], references: [id], onDelete: SetNull)

  // timestamps
  createdAt DateTime @default(now())

  // indexes
  @@index([contractId])
}

// ===================================
// ğŸ–¼ï¸ Image (ì´ë¯¸ì§€)
// ===================================
model Image {
  id          Int      @id @default(autoincrement())
  fileName    String // ì›ë³¸ íŒŒì¼ëª…
  fileUrl     String // ì €ì¥ëœ íŒŒì¼ URL
  fileSize    Int? // íŒŒì¼ í¬ê¸° (ë°”ì´íŠ¸ ë‹¨ìœ„)
  contentType String?  // MIME íƒ€ì…

  // Relations
  uploadedByUserId Int?
  uploadedByUser   User? @relation("UploadedImages", fields: [uploadedByUserId], references: [id], onDelete: SetNull)

  // timestamps
  createdAt DateTime @default(now())

  // indexes
  @@index([uploadedByUserId])
}

// ===================================
// ğŸ§© ENUM ì •ì˜
// ===================================

enum Gender {
  MALE // ë‚¨ì„±
  FEMALE // ì—¬ì„±
}

enum AgeGroup {
  TEEN_10 // 10ëŒ€
  TWENTIES_20 // 20ëŒ€
  THIRTIES_30 // 30ëŒ€
  FORTIES_40 // 40ëŒ€
  FIFTIES_50 // 50ëŒ€
  SIXTIES_60 // 60ëŒ€
  SEVENTIES_70 // 70ëŒ€
  EIGHTIES_80 // 80ëŒ€
}

enum Region {
  SEOUL // ì„œìš¸
  GYEONGGI // ê²½ê¸°
  INCHEON // ì¸ì²œ
  GANGWON // ê°•ì›
  CHUNGBUK // ì¶©ë¶
  CHUNGNAM // ì¶©ë‚¨
  SEJONG // ì„¸ì¢…
  DAEJEON // ëŒ€ì „
  JEONBUK // ì „ë¶
  JEONNAM // ì „ë‚¨
  GWANGJU // ê´‘ì£¼
  GYEONGBUK // ê²½ë¶
  GYEONGNAM // ê²½ë‚¨
  DAEGU // ëŒ€êµ¬
  ULSAN // ìš¸ì‚°
  BUSAN // ë¶€ì‚°
  JEJU // ì œì£¼
}

enum CarType {
  COMPACT // ê²½Â·ì†Œí˜•
  MID_SIZE // ì¤€ì¤‘Â·ì¤‘í˜•
  LARGE // ëŒ€í˜•
  SPORTS_CAR // ìŠ¤í¬ì¸ ì¹´
  SUV
} 

enum CarStatus {
  POSSESSION // ëŒ€ê¸°ì¤‘
  CONTRACT_PROCEEDING // ê³„ì•½ ì§„í–‰ì¤‘
  CONTRACT_COMPLETED // ê³„ì•½ ì™„ë£Œ
}

enum ContractStatus {
  CAR_INSPECTION // ì°¨ëŸ‰ ì ê²€
  PRICE_NEGOTIATION // ê°€ê²© í˜‘ìƒ
  CONTRACT_DRAFT // ê³„ì•½ì„œ ì´ˆì•ˆ
  CONTRACT_SUCCESSFUL // ê³„ì•½ ì„±ê³µ
  CONTRACT_FAILED // ê³„ì•½ ì‹¤íŒ¨
}

// ===================================
// ğŸš˜ CarModel: /cars/models ì‘ë‹µìš© (ì„ íƒ)
// ===================================
model CarModel {
  id           Int     @id @default(autoincrement())
  manufacturer String 
  model        String 
  type         CarType 
}