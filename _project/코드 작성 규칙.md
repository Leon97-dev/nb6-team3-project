# 코드 작성 규칙

## 컨트롤러 작성 시 아래 규칙을 준수합니다.

```ts
import { carService } from './car-service.js';

export const carController = {
  async create(...) {

    ...
    const result = await carService.createCar(...);

    res.status(200).json(result);
  },

  async update(...) {

    ...

  res.status(200).json(car);
  }
}
```

- 각 메서드는 비동기 함수로 작성합니다.
- 각 메서드는 `req`, `res` 파라미터를 가집니다.
- `next` 파라미터는 필요 시에만 추가합니다.
  - aync-handler를 route에 적용한 경우에는 `next` 파라미터를 생략합니다.
- 비즈니스 로직은 서비스 레이어에 위임합니다.
- 각 메서드는 `res.status(...).json(...)` 형태로 응답을 반환합니다.
- 상황에 맞게 에러 핸들러 이용해주세요

---

## 서비스 작성 시 아래 규칙을 준수합니다.

```ts
import { carRepository } from './car-repository.js';

export const carService = {
  async createCar(...) {

    ...
    // 디비 접근 가능한 레포지토리 호출
    const car = await carRepository.create({
      ...
    })

    return car;
  },
  async updateCar(...) {

    const car = await carRepository.findById(carId)

    ...

    return car;
  }
}
```

- 각 메서드는 비동기 함수로 작성합니다.
- 비즈니스 로직을 구현합니다.
- 필요한 경우, 여러 개의 서비스 메서드를 호출할 수 있습니다.
- 각 메서드는 처리 결과를 반환합니다.
- 상황에 맞게 에러 핸들러 이용해주세요
- 디비 접근은 레포지토리를 통해서만 합니다.
- 트랜잭션이 필요한 경우, 서비스 레이어에서 처리합니다.

---

## 레포지토리 작성 시 아래 규칙을 준수합니다.

```ts
import { CarModel } from './car-model.js';
import prisma from './prisma-client.js';

export const carRepository = {
  create(...) {
    return prisma.car.create({
      ...
    })
  },

  update(...) {
    return prisma.car.update({
      ...
    })
  }
}
```

- 프리즈마 클라이언트를 사용하여 데이터베이스와 상호작용합니다.
- 각 메서드는 동기 또는 비동기 함수로 작성할 수 있습니다.
- 프리즈마가 알아서 비동기 처리를 하기 때문에, 이번 프로젝트에서는 비동기 함수로 작성하지 않습니다.
- 데이터베이스 접근 로직을 구현합니다.
- 각 메서드는 처리 결과를 반환합니다.
- 디비 접근 용도라 에러 핸들러는 서비스 레이어에서 처리합니다.

---

## route 작성 시 아래 규칙을 준수합니다.

```ts
import { carController } from './car-controller.js';
import { Router } from 'express';
import asyncHandler from '../error/async-handler.js';
import { validate } from '../middlewares/validate.js';
import { carCreateSchema } from './car-validator.js';

export const router = Router();

router.get('/', asyncHandler(carController.list));

router.post('/', validate(carCreateSchema), asyncHandler(carController.create));

export default router;
```

- 각 route는 `express.Router()` 인스턴스를 생성합니다.
- 각 route는 컨트롤러 메서드를 `asyncHandler`로 감싸서 비동기 에러를 처리합니다.
- route 파일은 기본적으로 `export default router;` 형태로 내보냅니다.
- struct 유효성 검사 미들웨어가 필요한 경우, route 파일에 작성합니다.

---

## app.ts 작성 시 아래 규칙을 준수합니다.

```ts
import express from 'express';
import carRoutes from './car/car-router.js';
// [모듈 네임 단수형] + 'Routes' 형태로 import 합니다.

...

app.use('/cars', carRoutes);
```

---

## 폴더 구조

```bash
module/
  ├── cars/ # 복수형 폴더명 사용
      ├── car-controller.ts # 단수형 파일명 사용
      ├── car-repository.ts
      ├── car-service.ts
      ├── car-route.ts
      ├── car-validator.ts # 유효성 검사나 관련 미들웨어 작성

```

---

## 궁금한 점이 있으면 언제든지 물어보세요!
